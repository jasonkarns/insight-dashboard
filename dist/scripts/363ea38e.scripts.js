"use strict";var insightDashboardApp=angular.module("insightDashboardApp",[]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]);"use strict",insightDashboardApp.controller("MainCtrl",["$scope","$http","installs","visitors",function(a,b,c,d){var e=d3.time.format("%Y%m%d");a.installs=c.get,a.visitors=d.get,a.filterDateStart="20130306",a.filterDateEnd="20130310",a.filter=function(){var b=e.parse(a.filterDateStart),f=e.parse(a.filterDateEnd);return c.filter(b,f),d.filter(b,f),!1}}]),"use strict",insightDashboardApp.filter("prettyDate",function(){var a=d3.time.format("%d %b %Y");return function(b){return b instanceof Date?a(b):"invalid date"}}),"use strict",insightDashboardApp.directive("pieChart",function(){var a=d3.scale.category20c();return{restrict:"E",scope:{data:"=",width:"=",height:"="},link:function(c,d,e){var f=+c.width||400,g=+c.height||400,h=Math.min(f,g)/2,i=c.data,j=d3.svg.arc().outerRadius(h-10).innerRadius(0),k=d3.svg.arc().outerRadius(j.outerRadius()),l=d3.layout.pie().sort(null).value(function(a){return a.value}),m=d3.select(d[0]).append("svg").attr("class","pie-chart").attr("width",f).attr("height",g+50).append("g").attr("transform","translate("+f/2+","+(g/2+25)+")");c.$watch("data",function(b){var c=m.selectAll("path").data(l(b)).attr("d",j),d=m.selectAll("text").data(l(b)).text(function(a){return a.data.key}).attr("transform",function(a){return a.innerRadius=h+50,a.outerRadius=h,"translate("+k.centroid(a)+")"});c.enter().append("path").attr("fill",function(b){return a(b.data.key)}).attr("d",j),c.enter().append("text").style("text-anchor","middle").text(function(a){return a.data.key}).attr("dy",".35em").attr("transform",function(a){return a.innerRadius=h+50,a.outerRadius=h,"translate("+k.centroid(a)+")"}),c.exit().remove()})}}}),"use strict",insightDashboardApp.factory("installs",["$http",function(a){var b=d3.time.format("%Y%m%d"),c=[],d=[],e=undefined,f=undefined;return a.get("/installs").then(function(a){angular.forEach(a.data,function(a){a[0]=a[0].slice(9),a[1]=b.parse(a[1])});var g=crossfilter(a.data);e=g.dimension(function(a){return a[1]});var h=g.dimension(function(a){return a[0]});f=h.group().reduceSum(function(a){return a[2]}),c=f.top(100),d=c.slice(0,6)}),{get:function(a){return a?d:c},filter:function(a,b){e&&(e.filterRange([a,b]),c=f.top(100),d=c.slice(0,6))}}}]),"use strict",insightDashboardApp.factory("visitors",["$http",function(a){var b=d3.time.format("%Y%m%d"),c=[],d=undefined;return a.get("/visitors").then(function(a){angular.forEach(a.data,function(a){a[0]=b.parse(a[0])});var e=crossfilter(a.data);d=e.dimension(function(a){return a[0]}),c=d.top(Infinity)}),{get:function(){return c},filter:function(a,b){d&&(d.filterRange([a,b]),c=d.top(Infinity))}}}]);